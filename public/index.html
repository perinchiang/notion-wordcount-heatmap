<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Notion Task Heatmap</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cal-heatmap/cal-heatmap.css" />
    <style>
        body {
            /* 1. 设置透明背景，完美融入 Notion */
            background-color: transparent; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            padding: 20px;               /* 建议加一点点边距，不然贴着边缘太挤了 */
        }
        
        #cal-heatmap {
            /* 2. 移除多余的边距，更紧凑 */
            margin: auto;
        }

        /* 3. 修改月份和星期标签的颜色为 Notion 浅灰色 */
        .graph-label {
            fill: #999999 !important;
            font-size: 10px;
        }
        
        /* 4. 隐藏自带的那个标题，更简洁 */
        .graph-subdomain-group rect {
            shape-rendering: geometricPrecision; /* 让圆角更圆润 */
        }
    </style>
</head>
<body>

    <div id="cal-heatmap"></div>

    <script src="https://cdn.jsdelivr.net/npm/d3@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/cal-heatmap/cal-heatmap.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const baseUrl = window.location.origin;
            
            // 自动计算起始日期：显示最近 6 个月（包含本月）
            var now = new Date();
            var startDate = new Date(now);
            startDate.setMonth(now.getMonth() - 11);

            // 初始化热力图
            const cal = new CalHeatMap();
            
            // --- 核心配置修改 ---
            cal.init({
                itemSelector: "#cal-heatmap",
                domain: "month",
                subDomain: "day",
                
                start: startDate,
                range: 12,
                
                data: baseUrl + "/api/database",
                dataType: "json",

                // ✨ 美化部分：模仿 Notion 原生风格 ✨
                cellSize: 13,        // 格子稍微大一点
                cellPadding: 3,      // 格子间距
                domainGutter: 4,     // 月份之间挨得紧一点
                cellRadius: 3,       // ✅ 圆角矩形（0是直角，6是圆形）
                
                // 字体设置
                fontFamily: "-apple-system, sans-serif",

                // 颜色阈值：根据你的字数来定 (比如 100字, 300字, 600字, 1000字)
                legend: [100, 300, 600, 1000],
                
                // ✅ 颜色方案：Notion 黑白灰性冷淡风
                legendColors: {
                    min: "#E3E2E0",   // 浅灰 (少量)
                    max: "#37352F",   // 深黑 (大量)
                    empty: "#F7F6F3"  // 极浅灰 (未打卡)
                },

                tooltip: true,
                subDomainTitleFormat: {
                    empty: "{date}: 摸鱼 (0字)",
                    filled: "{date}: {count} 字"
                },
                
                // 数据处理：转换日期格式
                afterLoadData: function(data) {
                    if (!data || data.length === 0) {
                        return {};
                    }
                    var result = {};
                    data.forEach(function(item) {
                        var dateTimestamp = Math.floor(new Date(item.date).getTime() / 1000);
                        result[dateTimestamp] = item.count;
                    });
                    return result;
                }
            });
        });
    </script>
</body>
</html>


